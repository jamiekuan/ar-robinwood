<script>
  AFRAME.registerComponent("auto-switch-model", {
    init: function () {
      const model1 = document.querySelector("#model1-entity");
      const model2 = document.querySelector("#model2-entity");
      const text = document.querySelector("#dialogue-text");

      const dialogue = [
        "Congratulations!",
        "You've found all exhibitions today,",
        "but...",
        "I won't stop stealing staffs,",
        "as I'm Robinwood!"
      ];
      let currentLine = 0;

      const advanceDialogue = () => {
        if (currentLine < dialogue.length - 1) {
          currentLine++;
          text.setAttribute("value", dialogue[currentLine]);
        } else {
          model1.removeEventListener("click", advanceDialogue);
          model2.removeEventListener("click", advanceDialogue);
          text.removeEventListener("click", advanceDialogue);
        }
      };

      // 切換到第二個模型並重啟動畫
      const showModel2 = () => {
        model1.setAttribute("visible", false);
        model2.setAttribute("visible", true);
        
        // 🔥 重新觸發 animation-mixer，確保動畫播放
        model2.removeAttribute("animation-mixer");
        model2.setAttribute("animation-mixer", "");
      };

      // 點擊事件
      model1.addEventListener("click", advanceDialogue);
      model2.addEventListener("click", advanceDialogue);
      text.addEventListener("click", advanceDialogue);

      // 播放完第一個模型動畫時切換
      model1.addEventListener("animation-finished", showModel2);

      // 備案：5 秒後強制切換
      setTimeout(showModel2, 5000);
    },
  });

  document.querySelector("a-scene").setAttribute("auto-switch-model", "");
</script>
